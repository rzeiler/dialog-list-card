(()=>{"use strict";function t(t,e={}){Object.keys(e).forEach(i=>{try{t[i]=e[i]}catch(n){try{t.setAttribute(i,String(e[i]))}catch(t){}}})}function e(t,e={}){Object.keys(e).forEach(i=>{const n=e[i];!1===n||null==n?t.removeAttribute(i):!0===n?t.setAttribute(i,""):t.setAttribute(i,String(n))})}function i(i,n={}){const{props:s={},attrs:a={},slotName:o=null,style:d={},cssVars:h={},text:r=""}=n,l=document.createElement(i);return o&&(l.slot=o),r&&(l.innerText=r),e(l,a),t(l,s),d&&Object.assign(l.style,d),function(t,e={}){Object.keys(e).forEach(i=>{const n=e[i];!1===n||null==n?t.removeProperty(i):t.setProperty(i,String(n))})}(l.style,h),l}class n extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this._hass=null,this._config=null}set hass(t){this._hass=t}set config(t){this._config=t}connectedCallback(){}render(){this.dialog=i("ha-dialog",{props:{hideActions:!0,scrimClickAction:!0,escapeKeyAction:!0},cssVars:{"--vertical-align-dialog":"flex-start","--dialog-surface-margin-top":"40px","--dialog-content-padding":"0px","--mdc-dialog-min-width":this.isWide?"580px":"90vw","--mdc-dialog-max-width":this.isWide?"580px":"90vw","--mdc-dialog-max-height":"calc(100% - 72px)"},attrs:{heading:""}});const t=i("ha-dialog-header"),e=i("span",{attrs:{slot:"title"},text:this._config.dialog_title||this._config.title||"Dialog List"});t.appendChild(e);const n=i("ha-icon-button",{attrs:{slot:"navigationIcon",dialogAction:"cancel",label:`${this._hass.localize("ui.common.close")}`},props:{path:"M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"}});t.appendChild(n),this.dialog.appendChild(t),this.dialog.addEventListener("closed",()=>{this.shadowRoot.innerHTML=""}),this.shadowRoot.appendChild(this.dialog),this.list=i("ha-list"),this.dialog.appendChild(this.list),this._config.entities.map(t=>{this._hass.states[t];const e=this.getListItem(t),i=()=>this.serviceCall(e.domain,t);e.addEventListener("click",i),e.addEventListener("touchend",i),this.list.appendChild(e)})}isWide(){return window.matchMedia("(min-width: 600px) and (min-height: 501px)").matches}serviceCall(t,e){var i="toggle";("script"===t||"scene"===t)&&(i="turn_on"),this._hass.callService(t,i,{entity_id:e.entity}).then(t=>{this.dialog.remove()})}open(){this.render(),this.dialog.open=!this.dialog.open}getListItem(t){const e="string"==typeof t?t:t.entity,n=this._hass.states[e];if(!n)return;const s=i("ha-md-list-item",{props:{interactive:!0,multiline:!0},attrs:{type:"button"}}),a=i("ha-relative-time",{props:{hass:this._hass,datetime:n?.attributes.last_triggered},attrs:{slot:"supporting-text"}});s.appendChild(a);const o=i("span",{attrs:{slot:"headline",datetime:n?.attributes.last_triggered},text:t.title||n.attributes.friendly_name||e});s.appendChild(o);const d=e.split(".")[0];s.domain=d;const h=i("span",{attrs:{slot:"trailing-supporting-text"},text:d});s.appendChild(h);const r=i("ha-state-icon",{attrs:{slot:"start"},props:{hass:this._hass,stateObj:n},cssVars:{"--mdc-icon-size":"28px"}});return s.appendChild(r),s}}customElements.define("dialog-list",n);class s extends HTMLElement{setConfig(t){this.config={title:"Services",icon:"mdi:unicorn",dialog_title:"Chose Service",state_on_entity:"",host:"",entities:[],...t},this.render()}connectedCallback(){this.shadowRoot||this.attachShadow({mode:"open"}),this.render()}render(){if(!this.shadowRoot)return;if(this.card)return;this.card=i("ha-card",{style:{display:"flex",alignItems:"center",height:"100%",padding:"5px 10px",cursor:"pointer"}}),this.shadowRoot.appendChild(this.card);const t=i("div",{style:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",minWidth:"36px",height:"36px",borderRadius:"50px",overflow:"hidden",transition:"box-shadow 180ms ease-in-out",backgroundColor:"rgba(158,158,158,0.1)"}});this.card.appendChild(t);const e=i("ha-state-icon",{attrs:{icon:this.config.icon},cssVars:{"--mdc-icon-size":"28px"}});t.appendChild(e);const n=i("ha-info",{style:{padding:"5px 10px"}});this.card.appendChild(n);const s=i("div",{text:this.config.title});n.appendChild(s);let a=this._getLatestFromList(this.config.entities);void 0!==this.config.entities&&0!==this.config.entities.length||(a=Date.now());const o=i("ha-relative-time",{props:{hass:this._hass,datetime:a}});n.appendChild(o),this.card.addEventListener("click",()=>{this.dialog=i("dialog-list"),this.shadowRoot.appendChild(this.dialog),this.dialog.config=this.config,this.dialog.hass=this._hass,this.dialog.open()})}set hass(t){this._hass=t}get hass(){return this._hass}_getLatestFromList(t){return(t||[]).map(t=>{const e=this._hass.states[t.entity],i=e?.attributes?.last_triggered||e?.last_changed;return i?new Date(i):null}).filter(t=>null!==t).sort((t,e)=>e-t)[0]||null}getCardSize(){return 1}getGridOptions(){return{rows:1,columns:6}}static getConfigElement(){return document.createElement("dialog-list-editor")}}customElements.define("dialog-list-card",s),window.customCards=window.customCards||[],window.customCards.push({type:"dialog-list-card",name:"Dialog List Card",description:"Ein Dialog mit Aktionen",preview:!0});class a extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this._config={title:"Services",icon:"mdi:menu",dialog_title:"Chose Service",state_on_entity:"",host:"",entities:[]}}set hass(t){this._hass=t}setConfig(t){this._config={title:"Services",icon:"mdi:unicorn",dialog_title:"Chose Service",state_on_entity:"",host:"",entities:[],...t},this.renderted?this.update():this.render()}connectedCallback(){this.shadowRoot||this.attachShadow({mode:"open"}),this.renderted?this.update():this.render()}update(){if(!this.shadowRoot)return;if(!this._hass)return;if(!this._config)return;this.shadowRoot.getElementById("title").value=this._config.title||"",this.shadowRoot.getElementById("dialog_title").value=this._config.dialog_title||"",this.shadowRoot.getElementById("icon").value=this._config.icon||"";let t=this.shadowRoot.querySelectorAll("ha-form");const e=Array.from(t).find(t=>"state_on_entity"===t.id);e.schema=[{name:"entity",selector:{entity:{}}}],e.hass=this._hass,e.data={entity:this._config.state_on_entity},e.addEventListener("value-changed",t=>this._updateConfig("state_on_entity",t.detail.value.entity));const n=this.shadowRoot.getElementById("entities");(this._config.entities||[]).map((e,s)=>{let a=Array.from(t).find(t=>t.id===`entity${s}`);void 0===a&&(a=i("ha-form",{attrs:{id:`entity${s}`,class:"pb-1"},style:{"--mdc-dialog-content-ink-color":"transparent"}}),a.addEventListener("value-changed",t=>this._updateEntity(s,t.detail.value.entity)),n.appendChild(a)),a.schema=[{name:"entity",selector:{entity:{}}}],a.hass=this._hass,a.data={entity:e.entity}}),t=this.shadowRoot.querySelectorAll("ha-form"),this.removeLabel(t)}render(){if(!this.shadowRoot)return;if(!this._hass)return;if(!this._config)return;this.renderted=!0,this.shadowRoot.innerHTML=`\n      <style>\n        ha-form-grid {\n          display: grid !important;\n          grid-template-columns: repeat(var(--form-grid-column-count, auto-fit), minmax(var(--form-grid-min-width, 200px), 1fr));\n          grid-column-gap:10px;\n          grid-row-gap: 24px;\n        }\n        ha-button {\n          padding-top: 10px;\n        }  \n        --mdc-dialog-content-ink-color: red; \n      </style>\n      <ha-form-expandable>\n        \x3c!-- Titel --\x3e\n        <ha-expansion-panel expanded outlined icon="menu" header="Titles">\n          <ha-form-grid>\n            <ha-textfield\n              label="Title"\n              value="${this._config.title||""}"\n              id="title"\n            ></ha-textfield>\n            <ha-textfield\n              label="Dialog Title"\n              value="${this._config.dialog_title||""}"\n              id="dialog_title"\n            ></ha-textfield>\n            <ha-icon-picker\n              label="Symbol"\n              hass=${this._hass}\n              value="${this._config.icon||""}"\n              id="icon"\n            ></ha-icon-picker>\n          </ha-form-grid>\n          <ha-form\n            id="state_on_entity"\n          ></ha-form>\n        </ha-expansion-panel>\n        <ha-expansion-panel id="entities" expanded outlined icon="menu" header="Entitäten (erforderlich)">\n            ${(this._config.entities||[]).map((t,e)=>`<ha-form style="--mdc-dialog-content-ink-color:transparent;" class='pb-1' id="entity${e}"></ha-form>`).join("")}\n            <ha-button id="addEntity">+ Entity hinzufügen</ha-button>\n        </ha-expansion-panel>\n      </ha-form-expandable>\n    `;const t=this.shadowRoot.querySelectorAll("ha-form"),e=Array.from(t).find(t=>"state_on_entity"===t.id);e.schema=[{name:"entity",selector:{entity:{}}}],e.hass=this._hass,e.data={entity:this._config.state_on_entity},(this._config.entities||[]).map((e,i)=>{const n=Array.from(t).find(t=>t.id===`entity${i}`);n.schema=[{name:"entity",selector:{entity:{}}}],n.hass=this._hass,n.data={entity:e.entity}}),this.removeLabel(t),this.shadowRoot.getElementById("title")?.addEventListener("input",t=>this._updateConfig("title",t.target.value)),this.shadowRoot.getElementById("dialog_title")?.addEventListener("input",t=>this._updateConfig("dialog_title",t.target.value)),this.shadowRoot.getElementById("icon")?.addEventListener("value-changed",t=>this._updateConfig("icon",t.detail.value)),this.shadowRoot.getElementById("state_on_entity")?.addEventListener("value-changed",t=>this._updateConfig("state_on_entity",t.detail.value.entity)),this._config.entities.forEach((t,e)=>{const i=this.shadowRoot.getElementById(`entity_${e}`);i?.addEventListener("value-changed",t=>this._updateEntity(e,t.detail.value.entity))}),this.shadowRoot.getElementById("addEntity")?.addEventListener("click",()=>this._addEntity())}removeLabel(t){(async()=>{const e=["ha-selector","ha-selector-entity","ha-entity-picker","ha-generic-picker","label"];for(const i of t){let t=i;for(const i of e)if(t=await this.waitForElement(t,i,100),"label"==i&&t&&t.parentNode&&t.parentNode.removeChild(t),!t)break}})()}waitForElement(t,e,i=50){return new Promise(n=>{const s=Date.now(),a=()=>{const o=t?.shadowRoot?.querySelector(e);o||Date.now()-s>i?n(o||null):requestAnimationFrame(a)};a()})}_updateConfig(t,e){this._config={...this._config,[t]:e},this.fireChange()}_updateEntity(t,e){const i=[...this._config.entities];i[t]=e,this._config={...this._config,entities:i},this.fireChange()}_addEntity(){this._config={...this._config,entities:[...this._config.entities,""]},this.fireChange()}fireChange(){const t=new CustomEvent("config-changed",{detail:{config:this._config},bubbles:!0,composed:!0});this.dispatchEvent(t)}}customElements.define("dialog-list-editor",a)})();